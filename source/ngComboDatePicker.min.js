/*
 * ngComboDatePicker v1.2.4
 * http://github.com/jfmdev/ngComboDatePicker
 * «Copyright 2015 Jose F. Maldonado»
 * License: LGPLv3 (http://www.gnu.org/licenses/lgpl-3.0.html)
 */
angular.module("ngComboDatePicker",[]).directive("ngComboDatePicker",function(){return{restrict:"AEC",scope:{ngModel:"=",ngDate:"@",ngMinDate:"@",ngMaxDate:"@",ngMonths:"@",ngOrder:"@",ngAttrsDate:"@",ngAttrsMonth:"@",ngAttrsYear:"@",ngYearOrder:"@",ngTimezone:"@",ngPlaceholder:"@"},controller:["$scope",function($scope){function parseDate(myDate,myTimezone){var res=null;return void 0!==myDate&&null!==myDate&&(myDate instanceof Date?res=myDate:"number"!=typeof myDate&&"string"!=typeof myDate||(res=new Date(isNaN(myDate)?myDate:parseInt(myDate,10)),res=adjustTimezone(res,myTimezone))),res}function adjustTimezone(myDate,myTimezone){var offset=isNaN(myTimezone)?(new Date).getTimezoneOffset():60*parseFloat(myTimezone);return new Date(myDate.getTime()+60*offset*1e3)}function maxDate(month,year){var res=31;return null!=month&&(4!=month&&6!=month&&9!=month&&11!=month||(res=30),null!=year&&2==month&&(res=year%4==0&&year%100!=0?29:28)),res}function parseJsonPlus(jsonObj){var res=null;if(null!=jsonObj){try{res=JSON.parse(jsonObj)}catch(ex){}if(null==res)try{res=JSON.parse(jsonObj.replace(/'/g,'"'))}catch(ex){}}return res}$scope.ngModel=parseDate($scope.ngModel,$scope.ngTimezone),$scope.ngAttrsDate=parseJsonPlus($scope.ngAttrsDate),$scope.ngAttrsMonth=parseJsonPlus($scope.ngAttrsMonth),$scope.ngAttrsYear=parseJsonPlus($scope.ngAttrsYear);var initDate=parseDate($scope.ngDate,$scope.ngTimezone);if(null!=initDate&&($scope.ngModel=initDate),"string"!=typeof $scope.ngOrder?$scope.ngOrder="dmy":$scope.ngOrder=$scope.ngOrder.toLowerCase(),$scope.minDate=parseDate($scope.ngMinDate,$scope.ngTimezone),null==$scope.ngMinDate){var now=adjustTimezone(new Date,$scope.ngTimezone);$scope.minDate=new Date(now.getFullYear()-100,now.getMonth(),now.getDate(),now.getHours(),now.getMinutes(),now.getSeconds(),now.getMilliseconds())}$scope.maxDate=parseDate($scope.ngMaxDate,$scope.ngTimezone),null==$scope.maxDate&&($scope.maxDate=adjustTimezone(new Date,$scope.ngTimezone)),$scope.ngModel<$scope.minDate&&($scope.ngModel=$scope.minDate),$scope.ngModel>$scope.maxDate&&($scope.ngModel=$scope.maxDate);var placeHolders=null;if(void 0!==$scope.ngPlaceholder&&null!==$scope.ngPlaceholder&&("string"==typeof $scope.ngPlaceholder||Array.isArray($scope.ngPlaceholder))){var holders="string"==typeof $scope.ngPlaceholder?$scope.ngPlaceholder.split(","):$scope.ngPlaceholder;if(3==holders.length){placeHolders=[];for(var h=0;h<holders.length;h++)placeHolders.push({value:"",name:holders[h],disabled:!1})}}$scope.years=[];for(var i=$scope.minDate.getFullYear();i<=$scope.maxDate.getFullYear();i++)$scope.years.push({value:i,name:i});"string"==typeof $scope.ngYearOrder&&0==$scope.ngYearOrder.indexOf("des")&&$scope.years.reverse(),placeHolders&&$scope.years.unshift(placeHolders[0]);var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(void 0!==$scope.ngMonths&&null!==$scope.ngMonths){if("string"==typeof $scope.ngMonths){var months=$scope.ngMonths.split(",");12==months.length&&(monthNames=months)}Array.isArray($scope.ngMonths)&&12==$scope.ngMonths.length&&(monthNames=$scope.ngMonths)}$scope.updateMonthList=function(){var start=null!=$scope.ngModel&&$scope.ngModel.getFullYear()==$scope.minDate.getFullYear()?$scope.minDate.getMonth():0,end=null!=$scope.ngModel&&$scope.ngModel.getFullYear()==$scope.maxDate.getFullYear()?$scope.maxDate.getMonth():11;$scope.months=[],placeHolders&&$scope.months.push(placeHolders[1]);for(var i=start;i<=end;i++)$scope.months.push({value:i,name:monthNames[i]})},$scope.updateDateList=function(){var start=1;null!=$scope.ngModel&&$scope.ngModel.getMonth()==$scope.minDate.getMonth()&&$scope.ngModel.getFullYear()==$scope.minDate.getFullYear()&&(start=$scope.minDate.getDate());var end=null!=$scope.ngModel?maxDate($scope.ngModel.getMonth()+1,$scope.ngModel.getFullYear()):maxDate(null,null);null!=$scope.ngModel&&$scope.ngModel.getMonth()==$scope.maxDate.getMonth()&&$scope.ngModel.getFullYear()==$scope.maxDate.getFullYear()&&(end=$scope.maxDate.getDate()),$scope.dates=[],placeHolders&&$scope.dates.push(placeHolders[2]);for(var i=start;i<=end;i++)$scope.dates.push({value:i,name:i})},$scope.modelUpdated=function(){$scope.ngModel?($scope.date=$scope.ngModel.getDate(),$scope.month=$scope.ngModel.getMonth(),$scope.year=$scope.ngModel.getFullYear()):($scope.date="",$scope.month="",$scope.year="",placeHolders[0].disabled=!1,placeHolders[1].disabled=!1,placeHolders[2].disabled=!1),$scope.updateMonthList(),$scope.updateDateList()},$scope.$watch("ngModel",function(){$scope.modelUpdated()}),$scope.onChange=function(part){if(null!=$scope.date&&""!=$scope.date&&!isNaN(parseInt($scope.month))&&null!=$scope.year&&""!=$scope.year){var maxDay=maxDate($scope.month+1,$scope.year),hours=0,minutes=0,seconds=0,milliseconds=0;null!=$scope.ngModel&&(hours=$scope.ngModel.getHours(),minutes=$scope.ngModel.getMinutes(),seconds=$scope.ngModel.getSeconds(),milliseconds=$scope.ngModel.getMilliseconds()),$scope.ngModel=new Date($scope.year,$scope.month,$scope.date>maxDay?maxDay:$scope.date,hours,minutes,seconds,milliseconds)}placeHolders&&(""!=$scope.year&&(placeHolders[0].disabled=!0),""!=$scope.month&&(placeHolders[1].disabled=!0),""!=$scope.date&&(placeHolders[2].disabled=!0)),$scope.updateMonthList(),$scope.updateDateList()},$scope.getSomething=function(){return"color:red;"}}],link:function(scope,element,attrs){var jqLite=angular.element,children=jqLite(element[0]).children(),order=scope.ngOrder.split("");null!=scope.ngAttrsDate&&jqLite(children[0]).attr(scope.ngAttrsDate),null!=scope.ngAttrsMonth&&jqLite(children[1]).attr(scope.ngAttrsMonth),null!=scope.ngAttrsYear&&jqLite(children[2]).attr(scope.ngAttrsYear);for(var i=0;i<order.length;i++)"d"==order[i]&&jqLite(element[0]).append(children[0]),"m"==order[i]&&jqLite(element[0]).append(children[1]),"y"==order[i]&&jqLite(element[0]).append(children[2])},template:function(){var html='<select ng-model="date" ng-change="onChange(\'date\')" ng-options="date.value as date.name disable when date.disabled for date in dates"></select><select ng-model="month" ng-change="onChange(\'month\')" ng-options="month.value as month.name disable when month.disabled for month in months"></select><select ng-model="year" ng-change="onChange(\'year\')" ng-options="year.value as year.name disable when year.disabled for year in years"></select>';return html}}});